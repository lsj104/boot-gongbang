<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="feed">
    <select id="list" resultType="com.test.gongbang.feed.service.FeedDTO">
        select * from tblFeed order by seq desc
    </select>

    <select id="feedview" resultType="com.test.gongbang.feed.service.FeedDTO" parameterType="String">
        select * from tblFeed where seq = #{seq}
    </select>

    <select id="feedcomment" resultType="com.test.gongbang.feed.service.FeedCommentDTO" parameterType="String">
        select
            c.*,
            case
                when a.lv = 1 then m.nickname
                when a.lv = 2 then s.nickname
                end as nickname,
            case
                when a.lv = 1 then m.image
                when a.lv = 2 then s.image
                end as image
        from tblFeedComment c
                 inner join tblAccount a on c.aseq = a.seq
                 left outer join tblMember m on m.aseq = a.seq
                 left outer join tblShop s on s.aseq = a.seq
        where fseq = #{seq}
    </select>

    <insert id="feedadd" parameterType="com.test.gongbang.feed.service.FeedDTO">
        insert into TBLFEED values (seqFeed.nextval, #{content}, sysdate, #{image}, #{aseq})
    </insert>

    <select id="getBseq" resultType="String">
        select max(seq) as seq from TBLFEED
    </select>

    <select id="existHashTag" resultType="boolean" parameterType="String">
        select count(*) as cnt from TBLHASHTAG where name=#{tagName}
    </select>

    <select id="getRHseq" resultType="String" parameterType="String">
        select seq from TBLHASHTAG where name=#{tagName}
    </select>

    <insert id="addHashTag" parameterType="String">
        insert into TBLHASHTAG values (SEQHASHTAG.nextval, #{tagName})
    </insert>

    <select id="getHseq" resultType="String">
        select max(seq) as seq from TBLHASHTAG
    </select>
    
    <insert id="addTagging" parameterType="java.util.HashMap">
        insert into TBLFEEDHASHTAG values (SEQFEEDHASHTAG.nextval, #{hseq}, #{bseq})
    </insert>

</mapper>

