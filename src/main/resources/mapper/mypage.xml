<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mypage">

    <select id="reserveinfo" parameterType="String" resultType="com.test.gongbang.member.service.MemberDTO">
        select
            c.duedate as duedate,
            c.name as name,
            c.image as image,
            mc.rdate as rdate,
            mc.rmembercnt as rmembercnt,
            mc.seq as seq,
            c.DUETIME as duetime,
            c.seq as cseq
        from tblMemberClass mc
                 inner join tblClass c
                            on mc.cseq = c.seq
                 inner join tblShop s
                            on c.sseq = s.seq
        where mc.mseq = (select seq from tblMember where aseq = #{aseq})
    </select>

    <select id="gongbangclasslist" parameterType="String" resultType="com.test.gongbang.sclass.service.ClassDTO">
        select
            c.*,
            count(mc.seq) as rmembercnt
        from tblClass c
                 inner join TBLMEMBERCLASS mc
                            on c.seq = mc.cseq
        where sseq = (select seq from tblshop where aseq = #{aseq})
        group by c.SEQ, c.CSEQ, NAME, INTRO, COURSE, TIME, DUEDATE, MEMBERCNT, PRICE, IMAGE, SSEQ, DUETIME
        order by duedate desc
    </select>

    <select id="gongbangclassinfo" parameterType="String" resultType="com.test.gongbang.sclass.service.ClassDTO">
        select * from TBLCLASS
            where seq = #{seq}
    </select>

    <update id="memberedit" parameterType="com.test.gongbang.member.service.MemberDTO">
        update TBLMEMBER
        <set>
            <if test="nickname != null">NICKNAME = #{nickname},</if>
            <if test="image != null">IMAGE = #{image},</if>
            <if test="tel != null">TEL = #{tel},</if>
            <if test="address != null">ADDRESS = #{address},</if>
        </set>
        where ASEQ = #{seq}
    </update>

    <delete id="reservedel" parameterType="String">
        delete from TBLMEMBERCLASS where SEQ = #{seq}
    </delete>

    <select id="reservemember" parameterType="String" resultType="com.test.gongbang.member.service.MemberDTO">
        select
            mc.RDATE as rdate, --예약날짜
            mc.RMEMBERCNT as rmembercnt, --예약인원
            m.NAME as name, --예약자명
            m.TEL as tel -- 연락처
        from TBLMEMBERCLASS mc
                 inner join TBLMEMBER m
                            on mc.mseq = m.seq
        where cseq = #{seq}
    </select>

    <update id="gongbangedit" parameterType="com.test.gongbang.member.service.MemberDTO">
        update TBLSHOP
        <set>
            <if test="nickname != null">NICKNAME = #{nickname},</if>
            <if test="image != null">IMAGE = #{image},</if>
            <if test="tel != null">TEL = #{tel},</if>
            <if test="address != null">ADDRESS = #{address},</if>
        </set>
        where ASEQ = #{seq}
    </update>
</mapper>